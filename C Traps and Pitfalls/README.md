# C Traps and Pitfalls

## 词法陷阱

在C语言中，符号之间的空白（空格符，制表符，换行符）将被忽略



### = 不同于 ==

- 考虑使用频率，= 被赋予赋值含义，== 被赋予比较是否相等含义

- C/C++中，对于赋值表达式的真值，为赋值操作结束后，左变量的真值

    > ~~~c
    > int a, b;
    > b = 1;
    > 
    > a = b; //此时 a=b 语句的真值就为a的值，即1
    > ~~~

### & 和 | 不同于 && 和 ||

- 前者为按位运算符，后者为逻辑运算符

### 词法分析中的“贪心法”

- 每一个符号应该包含尽可能多的字符。

    > ~~~c
    > /*/*/0*/**/
    >     
    >     允许嵌套：/* /* /0 */ * */ 1 --》1
    >     不允许：  /* / */ 0* /**/ 1  --》0*1 --》0
    > ~~~

- 准二义性

    > ~~~c
    > 
    > a/*p; 
    > 
    > 1： a /*p; 注释
    > 2： a / *p  -> a / (*p); 解引用
    > 
    > 在语句存在二义性问题时，善用()
    > ~~~
    >
    > 

### 整型常量，字符与字符串

- 注意计算中不同进制的数值表示，避免C语言以另一种进制读取数值。

- 单引号引起的一个字符实际上代表一个整数。

    > 字符在C语言中以ASCII码的形式存储

- 双引号引起的字符串，代表的是指向无名数组起始字符的指针。

    > 常量字符串根据语言的实现，存在不同的区域，如C语言中，常量字符串存在只读字段。

- 有的C语言编译器允许在一个字符常量中包含多个字符

    > 在VS2019中，允许字符常量最多包含4个字符，其值为最后一个字符





## 语法陷阱



### 理解函数声明

- `(*(void(*)())0)()`

    > 其意：调用地址为0的函数
    >
    > 0的类型： 返回类型为void，形参列表为空 的函数指针
    >
    > 解析：熟记 *，()，[]，(type) 优先级

- 任何C变量的声明都有两部分组成：类型以及一组类似表达式的声明符(declarator)
- 函数名实际为函数地址，func() 为 (*func)() 的简写

### 运算符优先级

- ![image-20230228150816048](%E5%9B%BE%E7%89%87/README/image-20230228150816048.png)

### 分号，switch，else悬挂问题

- 注意分号 ;

- 函数必有返回值类型

    > 1. 正常情况：声明了返回值类型，return
    > 2. 缺省返回值类型：默认为int，需要return
    > 3. void类型：不需要return

- switch语句

    > **switch** 语句必须遵循下面的规则：**//来自菜鸟编程**
    >
    > 1. **switch** 语句中的 **expression** 是一个常量表达式，必须是一个整型，枚举类型或字符型。// 表达式为特定类型，字符型因为其按ASCII码存储为整形，枚举型也可认为整形。
    > 2. 在一个 switch 中可以有任意数量的 case 语句。每个 case 后跟一个要比较的值和一个冒号。
    > 3. case 的 constant-expression必须与 switch 中的变量具有相同的数据类型，且必须是一个常量或字面量。**//case比较值必须唯一**
    > 4. 当被测试的变量等于 case 中的常量时，case 后跟的语句将被执行，直到遇到 **break** 语句为止。当遇到 **break** 语句时，switch 终止，控制流将跳转到 switch 语句后的下一行。
    > 5. 不是每一个 case 都需要包含 **break**。如果 case 语句不包含 **break**，控制流将会 继续 后续的 case，直到遇到 break 为止。**//从分支入口进入后，直到遇见 break; 或 '}' 结束**
    > 6. 一个 **switch** 语句可以有一个可选的 **default**，出现在 switch 的结尾。default 可用于在上面所有 case 都不为真时执行一个任务。default 中的 **break** 语句在尾部不是必需的。**//default默认在Switch语句结尾，不是结尾也不影响。**
    > 7. **break，终止当前循环体或Switch语句**

- if-else需要注意配对

## 语义陷阱

### 指针与数组

数组名含义

- sizeof 数组名 得到的是数组的大小

- &取地址数组名，得到的是整个数组的地址

- 其他情况下，数组名代表数组的第一个元素的地址

    > 牢记前两种特殊情况

数组名运算

- arr[i] == r[arr] == arr + i，本质上是指针的运算+解引用

- arr\[i][j] 与 \*(*(arr + i) + j) 的转换

- 数组指针与指针的转换

    > ~~~c
    > int arr1[10] --> int *p1;
    > int arr2[10][10] --> int (*p2)[10];
    > .....
    >     分析数组名的含义
    > ~~~
    >
    > 

### 非数组的指针

- 字符串常量的含义

    > 字符串常量代表了一块包括字符串中所有字符以及一个**空字符('\0')**的内存区域的地址

- malloc的使用

    > ~~~
    > 1. 头文件 malloc.h
    > 
    > 2. malloc申请内存可能发生‘内存分配失败’的情况， 会返回一个空指针null
    > 3. malloc申请的内存属于‘动态申请堆空间’，需要手动释放，否则可能会引发‘空间泄漏’
    > ~~~
    >
    > 

### 作为参数的数组声明

数组名作为形参时，C语言会将其转换成相同类型的指针

~~~c
void fun(int arr[]) --> void fun(int *arr)
void fun(int arr[][10]) --> void fun(int (*arr)[10])
~~~

将数组名作为形参的意义是**提醒程序员该形参是个数组**

### 避免“举隅法”

